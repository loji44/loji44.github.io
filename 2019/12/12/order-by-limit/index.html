<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="">
    <meta name="keywords"  content="PandaQ, PandaQ Blog, 博客, 个人网站, 互联网, Web, JavaScript, Java">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="MySQL分页+排序数据重复的问题 - PandaQ | PandaQ Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="
  最近工作中遇到一个使用MySQL分页+排序时，MySQL返回数据重复的问题。虽然以现在的水平还不知道具体原因，但是还是先要记录一下问题以及解决方案。待以后技术水平达到一定水准或者找到原因再回来更新这篇文章。

">
    
    <meta property="article:published_time" content="2019-12-12T03:03:43Z">
    
    
    
    <meta property="article:tag" content="MySQL">
    
    
    <meta property="og:image" content="http://pandaq.xyz/assets/images/avatar1.jpeg">
    <meta property="og:url" content="http://pandaq.xyz/2019/12/12/order-by-limit/">
    <meta property="og:site_name" content="PandaQ | PandaQ Blog">
    
    <title>MySQL分页+排序数据重复的问题 - PandaQ | PandaQ Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://pandaq.xyz/2019/12/12/order-by-limit/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">PandaQ Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/assets/images/tag-bg.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/assets/images/tag-bg.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=MySQL" title="MySQL">MySQL</a>
                        
                    </div>
                    <h1>MySQL分页+排序数据重复的问题</h1>
                    
                    <h2 class="subheading">mysql分页查询数据重复问题记录</h2>
                    <span class="meta">Posted by PandaQ Blog on 2019-12-12</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<blockquote>
  <p>最近工作中遇到一个使用MySQL分页+排序时，MySQL返回数据重复的问题。虽然以现在的水平还不知道具体原因，但是还是先要记录一下问题以及解决方案。待以后技术水平达到一定水准或者找到原因再回来更新这篇文章。</p>
</blockquote>

<h3 id="一问题描述">一、问题描述</h3>

<blockquote>
  <p>前提条件：使用的数据库版本为 MySQL 5.7</p>
</blockquote>

<p>有一张数据表：业务线数据表 <code class="language-plaintext highlighter-rouge">business_line</code> 的内容如下：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">1</span>        <span class="o">|</span>         <span class="mi">10</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">10</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">22</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">23</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">6</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">25</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">7</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">26</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">8</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">27</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">9</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">9</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">28</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">10</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">30</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">11</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">created_time</code>字段设计为<code class="language-plaintext highlighter-rouge">DEFAULT CURRENT_TIMESTAMP</code>，且由于表中的数据是使用<code class="language-plaintext highlighter-rouge">INSERT</code>语句批量一次性插入数据表中，所以每一行数据中的<code class="language-plaintext highlighter-rouge">created_time</code>字段值都是<code class="language-plaintext highlighter-rouge">2019-12-10 11:07:04</code>，这是前提。</p>
</blockquote>

<p>我的需求是在前端页面使用分页 + 按<code class="language-plaintext highlighter-rouge">created_time</code>降序排序的查询规则来查询并展示这个表的数据，分页语句为：<code class="language-plaintext highlighter-rouge">SELECT * FROM business_line ORDER BY created_time DESC LIMIT #{count} OFFSET #{offset};</code></p>

<p>现在查询第一页的数据（每页10条，offset为 0）：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">10</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">30</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">9</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">9</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">28</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">8</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">27</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">7</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">26</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">6</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">25</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">23</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">22</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>嗯 … 看着好像没啥问题。继续查询第二页数据（每页10条，offset为 10）：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">10</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>问题来了：第二页居然查出重复的数据，已知<code class="language-plaintext highlighter-rouge">业务线2</code>和<code class="language-plaintext highlighter-rouge">业务线12</code>在第一页查询的时候已经查出来了。总共就两页数据，反倒是<code class="language-plaintext highlighter-rouge">业务线1</code>和<code class="language-plaintext highlighter-rouge">业务线11</code>始终没有查出来！多么窒息的操作 …</p>

<h3 id="二问题原因追踪">二、问题原因追踪</h3>

<p>翻阅MySQL官网使用手册，在 <a href="https://dev.mysql.com/doc/refman/5.7/en/limit-optimization.html">8.2.1.17 LIMIT Query Optimization</a> 一章中找到一些原因：</p>

<blockquote>
  <p>If multiple rows have identical values in the ORDER BY columns, the server is free to return those rows in any order, and may do so differently depending on the overall execution plan. In other words, the sort order of those rows is nondeterministic with respect to the nonordered columns.</p>
</blockquote>

<p>这里意思是，如果 ORDER BY 所指定的排序字段中存在多行的值相同（就是我们遇到的情况），针对未指定排序的字段，MySQL返回的结果行数据的顺序是不确定的。既然返回的数据顺序不确定，那么在LIMIT取数据的时候，就有可能取到重复的数据，这就解释了我们遇到的情况为什么是这样的。可能MySQL就是这样设计的吧🤷‍♂️🤷‍♂️🤷‍♂️。</p>

<p>另一个影响数据顺序的因素是LIMIT子句，ORDER BY的时候，后面有LIMIT和没有LIMIT时返回数据的顺序是不一样的。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="c1">-- 注意：ORDER BY 后面没有跟 LIMIT 语句时返回的数据顺序：</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">1</span>        <span class="o">|</span>         <span class="mi">10</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">10</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">11</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">10</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">30</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">9</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">9</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">28</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">8</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">27</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">7</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">26</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">6</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">25</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">23</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">22</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>

<span class="c1">-- ORDER BY 后面跟 LIMIT 语句时返回的数据顺序：</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">22</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">23</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="三问题解决方案">三、问题解决方案</h3>

<p>当指定的排序字段存在多行数据中的值都一样的情况，MySQL的排序可能就会包含不确定性，就像问题中描述的现象一样：分页返回了重复的数据。为了消除这种不确定性，保证返回的数据顺序是确定的，可以额外使用其他具有唯一性的字段作为排序字段，例如自增ID。</p>

<p>所以根据上述问题中的场景，既然指定的排序字段 <code class="language-plaintext highlighter-rouge">created_time</code> 已经不可避免地在每行数据中包含了相同的值，那需要再额外使用一个其值具备唯一性的字段自增ID来作为排序字段，得到的分页结果将会是跟预期一样正常了。</p>

<p>现在查询第一页的数据（每页10条，offset为 0），注意额外加了 <code class="language-plaintext highlighter-rouge">id</code> 作为排序字段：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">id</span> <span class="k">LIMIT</span> <span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">1</span>        <span class="o">|</span>         <span class="mi">10</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">10</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">21</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">22</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">23</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">6</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">25</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">7</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">26</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">8</span>        <span class="o">|</span>         <span class="mi">11</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">27</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">9</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">9</span>        <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">28</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">10</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">30</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>继续查询第二页数据（每页10条，offset为 10），注意额外加了 <code class="language-plaintext highlighter-rouge">id</code> 作为排序字段：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">id</span> <span class="k">LIMIT</span> <span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">10</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="mi">11</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">11</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">34</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">04</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">12</span> <span class="mi">11</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">37</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>至此，分页数据重复的问题得到解决。</p>

<p><code class="language-plaintext highlighter-rouge">ORDER BY created_time DESC, id</code> 语句中，MySQL会优先使用 <code class="language-plaintext highlighter-rouge">created_time</code> 字段进行降序排序，当遇到 <code class="language-plaintext highlighter-rouge">created_time</code> 字段值一样时，会使用 <code class="language-plaintext highlighter-rouge">id</code> 进行升序排序（不指定则默认<code class="language-plaintext highlighter-rouge">ASC</code>），从而解决了 ORDER BY + LIMIT 组合使用时分页数据重复的问题了。</p>

<h3 id="四后续补充">四、后续补充</h3>

<p>MySQL 8.0 + 的版本已经不存在上述的问题。现在以MySQL 8.0版本来做实验，现在表中数据如下：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">1</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">6</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">7</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">8</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">9</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">9</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">10</span>       <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">11</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">11</span>       <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>现在查询第一页的数据（每页10条，offset为 0）：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">1</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">2</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">3</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">4</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">5</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">6</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">7</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">8</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">9</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">9</span>        <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">10</span>       <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>再查询第二页的数据每页10条，offset为 10）：</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">business_line</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span> <span class="k">OFFSET</span> <span class="mi">10</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">buz_line_name</span> <span class="o">|</span> <span class="n">company_id</span> <span class="o">|</span> <span class="n">status</span> <span class="o">|</span> <span class="n">created_time</span>        <span class="o">|</span> <span class="n">updated_time</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
<span class="o">|</span> <span class="mi">11</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">11</span>       <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">12</span> <span class="o">|</span> <span class="err">业务线</span><span class="mi">12</span>       <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span>      <span class="mi">0</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="mi">04</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">24</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------+------------+--------+---------------------+---------------------+</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>从结果上看，MySQL 8.0版本已经默认处理了这种情况，即如果排序字段值相同，则会再根据自增ID进行排序。</p>

<p>然而在官方的手册文档上，关于这部分的说明仍跟5.7版本一样：<a href="https://dev.mysql.com/doc/refman/8.0/en/limit-optimization.html">8.2.1.19 LIMIT Query Optimization</a>，不知道为何，也许文档没来得及修改？</p>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/12/10/telnet-command/" data-toggle="tooltip" data-placement="top" title="使用telnet命令来进行Dubbo接口测试">
                        Previous<br>
                        <span>使用telnet命令来进行Dubbo接口测试</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/12/14/dubbo-telnet-invoke-fastjson-error/" data-toggle="tooltip" data-placement="top" title="Dubbo telnet：invoke缺少fastjson惹的祸">
                        Next<br>
                        <span>Dubbo telnet：invoke缺少fastjson惹的祸</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                

                
            </div>  

    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0022" 
                    href="/archive/?tag=Java"
                    title="Java"
                    rel="14">Java</a>
        
                <a data-sort="0030" 
                    href="/archive/?tag=Linux"
                    title="Linux"
                    rel="6">Linux</a>
        
                <a data-sort="0032" 
                    href="/archive/?tag=%E5%B7%A5%E5%85%B7%E9%9B%86"
                    title="工具集"
                    rel="4">工具集</a>
        
                <a data-sort="0032" 
                    href="/archive/?tag=Dubbo"
                    title="Dubbo"
                    rel="4">Dubbo</a>
        
                <a data-sort="0033" 
                    href="/archive/?tag=%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"
                    title="设计模式"
                    rel="3">设计模式</a>
        
                <a data-sort="0034" 
                    href="/archive/?tag=Maven"
                    title="Maven"
                    rel="2">Maven</a>
        
                <a data-sort="0034" 
                    href="/archive/?tag=MySQL"
                    title="MySQL"
                    rel="2">MySQL</a>
        
                <a data-sort="0034" 
                    href="/archive/?tag=Redis"
                    title="Redis"
                    rel="2">Redis</a>
    </div>
</section>


                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("/js/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; PandaQ Blog 2021
                    <br>
                    Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a>. Theme by <a href="https://github.com/Huxpro/huxpro.github.io" target="_blank">Hux Blog</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("/js/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->



<!-- Multi-Lingual -->




<!-- Image to hack wechat -->
<!--<img src="/img/icon_wechat.png" width="0" height="0" />-->
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
